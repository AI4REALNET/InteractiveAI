<!-- Copyright (c) 2018-2022, RTE (http://www.rte-france.com)              -->
<!-- See AUTHORS.txt                                                       -->
<!-- This Source Code Form is subject to the terms of the Mozilla Public   -->
<!-- License, v. 2.0. If a copy of the MPL was not distributed with this   -->
<!-- file, You can obtain one at http://mozilla.org/MPL/2.0/.              -->
<!-- SPDX-License-Identifier: MPL-2.0                                      -->
<!-- This file is part of the OperatorFabric project.                      -->



<!doctype html>
<html lang="en">

<head>
  <meta charset="utf-8">
  <script src=".\shared\js\rte_functions.js"></script>
  <script src=".\shared\js\common_functions.js"></script>
  <script src=".\shared\js\swal_functions.js"></script>
  <title>Assistant CAB v3.0.5</title>
  <span id="login"></span>
  <base href="/">

  <meta name="viewport" content="width=device-width, initial-scale=1">

  <style title="opfabRootStyle">
    /** 
Style parameters is define using css variables --params

Just two variables are set here , the complete style is set by the navbar.component.ts using global-style.service.ts.

This two values are used when navbar is not yet loaded

These two parameters are place in this file as the style should have a title parameter (it 's not possible to give a name for the style in the angular.json file). 

*/


    :root {
      --opfab-bgcolor: #262f3d;
      --opfab-bgcolor-darker: #262f3d;
      --opfab-text-color: white;
      --opfab-input-text-color: white;
      --opfab-form-border-color: #606267;
      --opfab-form-label-text-color: #bababa;
    }
  </style>

  <link rel="icon" type="image/x-icon" href="favicon.ico">
  <script>
    var selectedUseCase = "none";
    var token = window.localStorage.token;
    var opFabPort = "2002";
    var cabPort = "3200";
    var activeUser;
    var entities;
    var groups;
    var mapInitialized = false;
    var latitude;
    var longitude;
    var altitude;
    var authorizedUseCase;
    var map;
    var sncfMarker;
    var markers = {};
    var increasedLongitude = -4.09445;
    var tokenSynchronizeUrl = ""
    var msg_train = ', Jean votre superviseur, la présence d’un voyageur malade à bord nous oblige à marquer un arrêt supplémentaire en gare de  Poitiers pour permettre l’intervention des services de secours. Des informations complémentaires vous seront communiquées ultérieurement. Merci de votre attention.';
    var msg_train2 = ', Jean votre superviseur, merci à toute personne ayant des connaissances médicales de se faire connaître auprès de la borne d’appel.';
    var msgs_train = [msg_train,msg_train2];
    var trainIconFr = "/assets/images/icons/train_framboise.png";
    var train_ko = "/assets/images/icons/train_ko.png";
    var train_ok = "/assets/images/icons/train_ok.png";
    var SNCFseverities = {
        ACTION : train_ko,
        ALARM : trainIconFr,
      } 
    var planeMarker;
    var contextSNCF;
    var host;
    var traceHost;
    var tracePort = 5200;
    var assistNeverTriggered = true;
    var jsonEventObject;
    var dateCtx = new Date();
    var myJsonSNCF = {
    "simulation_name": "bordeaux_tours_sim",
    "targets_list": [
        {
            "agent_id": 0,
            "targets": [
                {
                    "target_id": 8,
                    "passengers": 0,
                    "target_type": "STATION"
                }
            ]
        },
        {
            "agent_id": 1,
            "targets": [
                {
                    "target_id": 4,
                    "passengers": 0,
                    "target_type": "STATION"
                },
                {
                    "target_id": 2,
                    "passengers": 0,
                    "target_type": "STATION"
                },
                {
                    "target_id": 5,
                    "passengers": 0,
                    "target_type": "STATION"
                },
                {
                    "target_id": 1,
                    "passengers": 144,
                    "target_type": "STATION"
                },
                {
                    "target_id": 6,
                    "passengers": 0,
                    "target_type": "STATION"
                },
                {
                    "target_id": 0,
                    "passengers": 0,
                    "target_type": "STATION"
                }
            ]
        },
        {
            "agent_id": 2,
            "targets": [
                {
                    "target_id": 4,
                    "passengers": 0,
                    "target_type": "STATION"
                },
                {
                    "target_id": 2,
                    "passengers": 0,
                    "target_type": "STATION"
                },
                {
                    "target_id": 5,
                    "passengers": 0,
                    "target_type": "STATION"
                },
                {
                    "target_id": 1,
                    "passengers": 26,
                    "target_type": "STATION"
                },
                {
                    "target_id": 6,
                    "passengers": 0,
                    "target_type": "STATION"
                },
                {
                    "target_id": 0,
                    "passengers": 0,
                    "target_type": "STATION"
                }
            ]
        }
    ],
    "station_stops": [
        {
            "agent_id": 0,
            "targets": [
                {
                    "target_coordinate": [
                        8,
                        7
                    ],
                    "delay": 180,
                    "target_type": "STATION"
                }
            ]
        },
        {
            "agent_id": 1,
            "targets": [
                {
                    "target_coordinate": [
                        204,
                        7
                    ],
                    "delay": 6000,
                    "target_type": "STATION"
                },
                {
                    "target_coordinate": [
                        100,
                        6
                    ],
                    "delay": 180,
                    "target_type": "STATION"
                },
                {
                    "target_coordinate": [
                        8,
                        7
                    ],
                    "delay": 180,
                    "target_type": "STATION"
                }
            ]
        },
        {
            "agent_id": 2,
            "targets": [
                {
                    "target_coordinate": [
                        204,
                        7
                    ],
                    "delay": 6000,
                    "target_type": "STATION"
                },
                {
                    "target_coordinate": [
                        100,
                        6
                    ],
                    "delay": 180,
                    "target_type": "STATION"
                },
                {
                    "target_coordinate": [
                        8,
                        7
                    ],
                    "delay": 240,
                    "target_type": "STATION"
                }
            ]
        }
    ]
};

    checkTokenToMatchUseCase();

    function checkTokenToMatchUseCase(){
      if(window.location.host.includes("localhost")){
        tokenSynchronizeUrl = "http://192.168.211.95" + ":" + opFabPort + "/users/users/synchronizeWithToken";
        host = "http://192.168.211.95" + ":" + cabPort;
        traceHost = "http://192.168.211.95" + ":" + tracePort;
      }
      else{
        tokenSynchronizeUrl = "/users/users/synchronizeWithToken";
        host = "";
        traceHost = "";
      }
      var request = new XMLHttpRequest();
      request.onreadystatechange= function () {
          if (request.readyState==4) {
            response = JSON.parse(request.responseText)
            activeUser = response.login;
            entities = response.entities;
            groups = response.groups;
            authorizedUseCase = entities[0];
            document.getElementById("login").innerHTML = "Logged as " + authorizedUseCase;
            document.getElementById("login").style.color = "black";
            return entities[0];
          }
          console.log("token checked")
      }

      request.open("POST",tokenSynchronizeUrl, true);

      request.setRequestHeader("Accept","application/json");
      request.setRequestHeader("Authorization","Bearer "+token);
      request.send();
    }
    function orangeCtx(){
      document.getElementById("orange_ctx_container").innerHTML = "<img src='assets/images/orange_contexte_appx_y.png'>";
    }
    function selectUseCase(uc){
      if (uc == authorizedUseCase){
        grantedUseCase(authorizedUseCase);
        setCardsSeverity();
      }else{
        alert("Error: You're not allowed to access this environment")
      }
    }
   
    function getRecommandations(){
      document.getElementById("sncf_button_grey").style.cursor = 'wait';
      setTimeout(getRecoWithTimer,10000);
    }
    function getRecoWithTimer(){
      document.getElementById("sncf_solution_mock").hidden=false;
      document.getElementById("sncf_button_grey").style.cursor = 'unset';
    }
    function grantedUseCase(uc) {
      selectedUseCase = uc;
      if (uc != "DA"){
        document.documentElement.requestFullscreen();
      }
      console.log(uc + " selected as use case");
      switch (uc) {
        case "RTE":
          document.getElementById("usecase_hidden").text = "CAB RTE";
          document.getElementById("rte_checkboxes").hidden = false;
          document.getElementById("assist").hidden = false;
          document.getElementById("assistOpTitle").classList.add("assistOpTitleDA");
          document.getElementById("assistOpTitle").classList.add("orange_theme");
          document.getElementById("feed-content").classList.add("orange_theme");
          document.getElementById("feed-content").style.position = "absolute";
          document.getElementById("feed-content").classList.add("feed-content_optimized");
          document.getElementById("feed-content").classList.add("rteNotifsE");
          document.getElementById("ctx_div").classList.add("orange_theme");
          document.getElementById("ctx_div").classList.add("rte_ctx_div");
          document.getElementById("opfab-card-list").classList.add("rteNotifs");
          document.getElementById("opfab-card-list").classList.add("opfab-card-list-RTE");
          document.getElementById("feed-content").classList.add("rteNotifs");
          document.getElementById("ctxImg").classList.add("rte_ctxImg");
          document.getElementById("assistOpTitle").style.top = "80px";
          document.getElementById("assistOpTitle").classList.add("assistOpTitle_rte");
          document.getElementById("feed-content").style.top = "70px";
          document.getElementById("empty_block").hidden = true;
          document.getElementById("ctxImg").hidden = false;
          document.getElementById("map").hidden = true;
          document.getElementById("notifs_RTE").hidden = false;
          document.getElementById("notifContainer").innerHTML = document.getElementById("notifContainer").innerHTML.replace("Notifications","Alertes");
    

          setInterval(() => {
            refreshCtxRTE();
          }, 15000);
          break;
        case "DA":
          getCoordinates();
          document.getElementById("usecase_hidden").text = "CAB DA";
          document.getElementById("dassault_div").hidden = false;
          document.getElementById("dassault_title").hidden = false;
          document.getElementById("dassaultBar").hidden = false;
          document.getElementById("dassaultBar2").hidden = false;
          document.getElementById("feed-content").style.position = "absolute";
          document.getElementById("feed-content").classList.add("feed-content_optimized")
          document.getElementById("assistOpTitle").classList.add("assistOpTitleDA");
          document.getElementById("assistOpTitle").style.top = "80px";
          document.getElementById("opfab-card-list").style.overflowY = "hidden";
          document.getElementById("opfab-navbar-menu-feed").text = "CAB Dassault";
          document.getElementById("opfab-navbar-menu-menu1").text = "";
          document.getElementById("opfab-navbar-menu-feed").style.borderBottomStyle = "none";
          document.getElementById("tl-box").style.position = "fixed";
          document.getElementById("tl-box").style.bottom = "0";
          document.getElementById("ctx_div").classList += " dassault_ctx_div";
          document.getElementById("notifs_DA").hidden = false;
          document.getElementById("fake_notifs_DA").hidden = false;
          document.getElementById("noevent_da").hidden = false;
          // mettre un timer qui affiche cette notif en même temps que celel qui apparait
          document.getElementById("opfab-feed-filter-btn-filter").hidden = true;
          document.getElementById("da_block_request").hidden = false;
          document.getElementById("map").classList += " map_da";
          document.getElementById("notifContainer").innerHTML = document.getElementById("notifContainer").innerHTML.replace("Notifications","Failures");
          setInterval(() => {
            // refreshCtxDA();
          }, 110);
          opfabStyle.setCss(opfabStyle.NIGHT_STYLE);
          setDANotifications();
          // mapDA();
          break;
        case "ORANGE":
          
          document.getElementById("usecase_hidden").text = "CAB Orange";
          document.getElementById("opfab-navbar-menu-menu1").text = "";
          document.getElementById("opfab-navbar-menu-feed").style.borderBottomStyle = "none";
          // document.getElementsByClassName('opfab-navbar')[0].style.backgroundColor = "#4BB4E6"; //couleur topbar
          document.getElementById("opfab-navbar-menu-feed").style.color = "white";
          // mock poc v1/2 setTimeout(getOrangeIncidents,20000);
          document.getElementById("map").hidden = true;
          document.getElementById("correlation").hidden = false;
          document.getElementById("orange_ctx").hidden = false;
          document.getElementById("noevent_orange").hidden = false;
          document.getElementById("assistOpTitle").classList.add("orange_theme");
          document.getElementById("assistOpTitle").classList.add("assist_sncf");
          document.getElementById("assistOpTitle").classList.add("assistOpTitle");
          document.getElementById("assistOpTitle").style.top = "80px";
          document.getElementById("feed-content").style.position = "absolute";
          document.getElementById("feed-content").style.marginTop = "0px";
          document.getElementById("feed-content").classList.add("orange_theme");
          document.getElementById("feed-content").classList.add("feed-content_override");
          document.getElementById("ctx_div").classList.add("orange_theme");
          document.getElementById("ctx_div").classList.add("sncf_ctx_div");
          document.getElementById("ctx_div").classList.add("sncf");
          document.getElementById("assistOpTitle").classList.add("sncf");
          document.getElementById("assistOpTitle").classList.add("assist_orange_overflow_override");
          document.getElementById("feed-content").classList.add("sncf");
          document.getElementById("notifContainer").innerHTML = document.getElementById("notifContainer").innerHTML.replace("Notifications","Anomalies");
          setTimeout(() => {
            document.getElementById("opfab-feed-filter-btn-sort").click()
            document.getElementById("ngb-popover-2").hidden = true;
            document.getElementById("opfab-feed-filter-severity").click()
          }, 5000);
          break;
        case "SNCF":
          document.getElementById("usecase_hidden").text = "CAB SNCF";
          document.getElementById("opfab-navbar-menu-menu1").text = "";
          // document.getElementsByClassName('opfab-navbar')[0].style.backgroundColor = "#009AA6"
          document.getElementById("opfab-navbar-menu-feed").style.color = "white"
          document.getElementById("opfab-navbar-menu-feed").style.borderBottomStyle = "none";
          // document.getElementById("ctx_div").style.marginLeft = "440px";
          document.getElementById("sncf_assist_nominal").hidden = false;
          document.getElementById("assist").hidden = false;
          document.getElementById("assistOpTitle").classList += " sncf assist_sncf assistOpTitle";
          document.getElementById("assistOpTitle").style.top = "80px";
          document.getElementById("feed-content").style.position = "absolute";
          document.getElementById("feed-content").style.marginTop = "0px";
          document.getElementById("sncfControl").hidden = false;
          document.getElementById("feed-content").classList += " sncf";
          document.getElementById("feed-content").classList.add("feed-content_override");
          document.getElementById("ctx_div").classList+= " sncf sncf_ctx_div"
          document.getElementById("map").classList += " map_sncf";
          setInterval(() => {
            refreshCtxSNCF();
          }, 110);
          mapSNCF();
          break;
      }
      if(selectedUseCase != "DA"){
        document.getElementById("nominal_assist").hidden = false;
      }else{
        document.getElementById("nominal_assist_en").hidden = false;
      }
      document.getElementById("homescreen").style = "display:none";
      document.getElementById("assistOpTitle").hidden = false;
      initTimeLine();
    }

    function getOrangeIncidents(){
      document.getElementById("orange_incidents").hidden = false;
    }
    function selectDassaultCtx(type) {
      switch (type) {
        case "dependances":
          document.getElementById("dependances").hidden = false;
          document.getElementById("synoptique").hidden = true;
          document.getElementById("carte").hidden = true;
          document.getElementById("map").hidden = true;
          document.getElementById("synoptic_back").hidden = true;
          break;
        case "carte":
          document.getElementById("dependances").hidden = true;
          document.getElementById("synoptique").hidden = true;
          document.getElementById("carte").hidden = false;
          document.getElementById("map").hidden = false;
          document.getElementById("synoptic_back").hidden = true;
          if (!mapInitialized) {
            initMap("Dassault");
            mapInitialized = true;
          }
          break;
        case "synoptique":
          document.getElementById("dependances").hidden = true;
          document.getElementById("synoptic_back").hidden = false;
          document.getElementById("synoptique").hidden = false;
          document.getElementById("carte").hidden = true;
          document.getElementById("map").hidden = true;
          break;

      }
    }
    function selectSNCFCtx(type) {
      switch (type) {
        case "incident":
          document.getElementById("map").hidden = true;
          document.getElementById("sncf_ctx").hidden=true;
          document.getElementById("sncf_ctx_materiel").hidden=true;
          document.getElementById("sncf_incident_infos").hidden=false;
          document.getElementById("history").hidden=false;
          document.getElementById("incident").classList.remove("toBlink");
          break;
        case "materiel":
          document.getElementById("map").hidden = true;
          document.getElementById("sncf_ctx").hidden=true;
          document.getElementById("sncf_ctx_materiel").hidden=false;
          document.getElementById("sncf_incident_infos").hidden=true;
          document.getElementById("history").hidden=true;
          document.getElementById("materiel").classList.remove("toBlink");
          break;
        case "voyageurs":
          document.getElementById("map").hidden = true;
          document.getElementById("sncf_ctx_materiel").hidden=true;
          document.getElementById("sncf_ctx").hidden=false;
          document.getElementById("sncf_incident_infos").hidden=true;
          document.getElementById("history").hidden=true;
          document.getElementById("voyageurs").classList.remove("toBlink");
          break;
        case "carte":
          document.getElementById("map").hidden = false;
          document.getElementById("sncf_ctx").hidden=true;
          document.getElementById("sncf_ctx_materiel").hidden=true;
          document.getElementById("history").hidden=true;
          document.getElementById("sncf_incident_infos").hidden=true;
          break;

      }
    }
    
    function displayStats(value){
      hideAllSynops()
      switch (value){
        case 'STAT':
          document.getElementById("STATUS_nominal").hidden = false;
          break;
        case 'ECS':
          document.getElementById("ECS_nominal").hidden = false;
          break;
        case 'ELEC':
          document.getElementById("ELEC_nominal").hidden = false;
          break;
        case 'FUEL':
          document.getElementById("FUEL_nominal").hidden = false;
          break;
        case 'HYD':
          document.getElementById("HYD_nominal").hidden = false;
          break;
        case 'BLD':
          document.getElementById("BLEED_nominal").hidden = false;
          break;
        case 'TEST':
          document.getElementById("TEST_nominal").hidden = false;
          break;
        case 'ENG':
          document.getElementById("ENGINE_nominal").hidden = false;
          break;
      }
    }

    function hideAllSynops(){
      var synops = ['STATUS','ECS','ELEC','FUEL','HYD','BLEED','TEST','ENGINE'];
      for (var synop=0;synop<synops.length;synop++){
        try {
          document.getElementById(synops[synop]).hidden= true;
        } catch (error) {
          console.log("unknown synop element")
        }
        try {
          document.getElementById(synops[synop]+"_nominal").hidden= true;
        } catch (error) {
          console.log("unknown synop nominal element")
        }
      }
    }
       
    function setDANotifications(){
      try {
              setCardsForDA();
              setDescsForDA();
            } catch (error) {
            }

    }
    function setCardsForDA() {
      var cards = document.getElementsByClassName("card");
      for (var card = 0; card < cards.length; card++) {
          if (!cards[card].classList.contains("DA_Card") || !cards[card].classList.contains("light-card-detail-unselected-DA-MED")){
            cards[card].classList += " DA_Card light-card-detail-unselected-DA-MED";
          }
        }
      }
          
    function setDescsForDA() {
        var descs = document.getElementsByClassName("p-1");
        for(var desc = 0;descs.length;desc++){
            descs[desc].textContent="";
        }
    }

    function hideAssist(){
      document.getElementById("rte_assist_nominal").hidden = true;
    }

    function setCardsSeverity() {
      if (selectedUseCase == "SNCF"){
        var severities = document.getElementsByClassName("opfab-feed-list-card-severity")
        for (var severity = 0; severity < severities.length; severity++) {
          }
          var descs = document.getElementsByClassName("p-1");
         var titles = document.getElementsByClassName("card-title")

      }
      var cards = document.getElementsByClassName("card");
      for (var card = 0; card < cards.length; card++) {
        event_start_date = getCardContent(cards[card].getAttribute("data-urlid"),false,true,false);
        event_end_date = null;
        // event_end_date = getCardContent(cards[card].getAttribute("data-urlid"),false,false,true);
        event_start_date_formated = new Date (event_start_date).toLocaleTimeString('fr-FR', { hour: '2-digit', minute: '2-digit' })
        event_end_date_formated = new Date (event_end_date).toLocaleTimeString('fr-FR', { hour: '2-digit', minute: '2-digit' })
        var event_end_date_plus_5_hours = new Date(event_end_date).getTime() + 5 * 60 * 60 * 1000;
        var event_end_date_plus_5_hours_formated = new Date(event_end_date_plus_5_hours).toLocaleTimeString('fr-FR', { hour: '2-digit', minute: '2-digit' });
        event_end_date_formated = event_end_date_plus_5_hours_formated;
        try {
          cards[card].querySelector(".p-1").style.color = "grey";
        } catch (error) {
        }

        //positionner point sur timeline END DATE
        // hack pour obtenir l'id de la ligne de timeline associée à l'event
        try {
          card_timeline = document.querySelector('[event_id="' + cards[card].getAttribute("data-urlid").replace(selectedUseCase.toLowerCase()+"Process.","")
        + '"]').getAttribute("id").match(/\d+/)[0]
        //positionnerEndPoint
        // positionnerPointSurTimeline(event_end_date_plus_5_hours_formated, card_timeline);
        // if(event_end_date){
        //   positionnerPointFinDateEventSurTimeline(event_end_date_plus_5_hours_formated,card_timeline)
        // }
        } catch (error) {
        }

        cards[card].innerHTML = cards[card].innerHTML.replace("action ", "Sureté");
        cards[card].innerHTML = cards[card].innerHTML.replace("alarm ", "Sureté");
        cards[card].innerHTML = cards[card].innerHTML.replace("compliant ", "Maintenance ");
        cards[card].innerHTML = cards[card].innerHTML.replace("information ", "Maintenance ");
        cards[card].children[0].style.marginLeft = "20px";
        // cards[card].innerHTML += "<button onclick='acknowledgeEvent(" + cards[card].getAttribute("data-urlid").toString() + ",0)'> trashIcon </button>"
        try {
          cards[card].children[1].style.marginLeft = "20px";
        } catch (error) {
        }

        if (selectedUseCase == "SNCF"){
          cards[card].innerHTML = cards[card].innerHTML.replace("assets\\images\\opfab-bg-sev-action-icon.svg", "assets\\images\\impact_sncf.svg");

          if (!cards[card].classList.contains("SNCF_card")){
            cards[card].classList.add("SNCF_Card");
            try {
              getCardContent(cards[card].getAttribute("data-urlid"));
              cards[card].innerHTML = cards[card].innerHTML.replace("Sureté",getCardContent(cards[card].getAttribute("data-urlid"),true,false,false));
            } catch (error) {
            }
          }

          if (cards[card].classList.contains("light-card-detail-selected")){
            //carte selectionée classe SNCF
              cards[card].classList.add("sncf-light-card-selected");
              cards[card].classList.add("sncf-border-" + cards[card].attributes['severity'].value);
              cards[card].classList.remove("sncf-light-card-background-" + cards[card].attributes['severity'].value);
              cards[card].classList.add("sncfCard");
              cards[card].children[0].children[0].children[0].children[0].style.fontWeight = "100";
              console.log(cards[card].querySelector(".card-title").style.fontWeight = "100")
              if(assistNeverTriggered){
                document.getElementById("sncf_assist").hidden = false;
                assistNeverTriggered = false;
              }
          }
          if (cards[card].classList.toString().includes("light-card-detail-unselected")){
            //carte selectionée classe SNCF
              cards[card].classList.remove("sncf-light-card-selected");
            try {
              cards[card].classList.add("sncf-light-card-background-" + cards[card].attributes['severity'].value);
              cards[card].classList.remove("sncfCard");
              // cards[card].classList.add("sncfCardNotSelected");
              cards[card].classList.remove("sncf-border-" + cards[card].attributes['severity'].value);
              } catch (error) {
              }
          }
          if(cards[card].classList.toString().includes("light-card-detail-unread")){
            // carte non lue
            cards[card].style.color="white";
          }
        }else if (selectedUseCase == "RTE" && !cards[card].classList.toString().includes("light-card-border") && cards[card].classList.toString().includes("light-card-detail")){
              cards[card].classList.add("rteBg-"+ cards[card].attributes['severity'].value)
              
        }
        else if (selectedUseCase == "ORANGE" || selectedUseCase == "DA"){
          if (!cards[card].classList.toString().includes("light-card-background") && cards[card].classList.toString().includes("light-card-detail")){
            try {
              cards[card].classList.add("orangeBg-"+ cards[card].attributes['severity'].value)
              var card_hour = event_start_date_formated;
              cards[card].innerHTML = cards[card].innerHTML.replace("Sureté",card_hour);
              cards[card].innerHTML = cards[card].innerHTML.replace("Maintenance ",card_hour);
              cards[card].innerHTML = cards[card].innerHTML.replace("assets\\images\\opfab-bg-sev-action-icon.svg", "assets\\images\\opfab-bg-sev-alarm-icon.png");
              cards[card].innerHTML = cards[card].innerHTML.replace("assets\\images\\opfab-bg-sev-information-icon.png", "assets\\images\\icon _solve_.png");

            } catch (error) {
              //nothing to catch, normal behavior 
              console.log(error)
            }

          }
      }
      else if (selectedUseCase == "RTE"){
          if (cards[card].classList.contains("light-card-detail-selected")){
            document.getElementById("rte_assist_nominal").addEventListener("click",hideAssist);

              if(assistNeverTriggered){
                // document.getElementById("rte_assist_nominal").hidden = false;
                document.getElementById("rte_assist_nominal").setAttribute("assistNeverTriggered","false");
                assistNeverTriggered = false;
              }
          }
      }
    } 
      if (selectedUseCase == "DA"){
        setDANotifications();
        if(assistNeverTriggered){
          document.getElementById("dassault_assist").hidden = false;
          assistNeverTriggered = false;
        }
      }
    }
    function getCardContent(id_card,hasCustomSeverity,getEventTime,getEventTimeEnd) {
      if (id_card != null){
        var xmlHttp = new XMLHttpRequest();
        xmlHttp.open("GET", host + "/cards/cards/"+id_card,false);
        xmlHttp.setRequestHeader("Authorization","Bearer "+token);
        xmlHttp.send(null);
        var response = JSON.parse(xmlHttp.responseText);
        lastTrain = response.card.data.metadata.id_train;
        lastSeverity = response.card.severity;
        if(hasCustomSeverity){
          //get event_type instead of card severity [sncf] 
          return response.card.data.metadata.event_type;
        }
        if(getEventTime){
          return response.card.startDate;
        }
        if(getEventTimeEnd){
          // return response.card.endDate; -> waiting this attribute to be available from API
          return response.card.startDate;
        }
        updateTrainStatus(lastTrain,lastSeverity)
      }
    };

    function updateTrainStatus(id_train,severity){
      markers[id_train]._icon.src = SNCFseverities[severity]+"?time=" + new Date().getTime();
    }
    function refreshCtxRTE() {
      var xmlHttp = new XMLHttpRequest();
      xmlHttp.open("GET", host + "/cabcontext/api/v1/contexts?time=" + new Date().getTime(), false);
      xmlHttp.setRequestHeader("Authorization","Bearer "+token);
      xmlHttp.send(null);
      var response = JSON.parse(xmlHttp.responseText);
      document.getElementById("ctxImg").src = "data:image/png;base64," + response[0].data.topology;
      dateCtx = response[0].date;

    };
    function refreshCtxDA() {
      var xmlHttp = new XMLHttpRequest();
      xmlHttp.open("GET", host + "/cabcontext/api/v1/contexts?time=" + new Date().getTime(), false);
      xmlHttp.setRequestHeader("Authorization","Bearer "+token);
      xmlHttp.send(null);
      var response = JSON.parse(xmlHttp.responseText);
      setAndUpdateDAMarkersOnMap(response[0].data)
    };
    function getCorrelations() {
      var xmlHttp = new XMLHttpRequest();
      xmlHttp.open("GET", host + "/cab_correlation/api/v1/correlation?size=1", false);
      xmlHttp.setRequestHeader("Authorization","Bearer "+token);
      xmlHttp.send(null);
      var response = JSON.parse(xmlHttp.responseText);
      try {
        document.getElementById("orange_assist").innerHTML += Object.keys(response[0].data).length + " corrélations trouvées.";
      } catch (error) {
        document.getElementById("orange_assist").innerHTML += "Aucune corrélation trouvée.";
      }
      Object.entries(response[0].data).forEach(entry => {
        const [key, value] = entry;
        document.getElementById("orange_assist").innerHTML += '<span class="correlation"><b>' + key + '</b><button class="orange_button_theme">' + value[key] + '</button></span>'
      });
    };


    function refreshCtxSNCF() {
      var xmlHttp = new XMLHttpRequest();
      xmlHttp.open("GET", host + "/cabcontext/api/v1/contexts?time=" + new Date().getTime(), false);
      xmlHttp.setRequestHeader("Authorization","Bearer "+token);
      xmlHttp.send(null);
      var response = JSON.parse(xmlHttp.responseText);
      var trains = response[0].data.trains;
      contextSNCF = response[0].data;
      dateCtx = response[0].date;

      setAndUpdateSNCFMarkersOnMap(trains);
    };

    function getRecommandationSNCF(){
      console.log("getRecommandationSNCF")
        document.getElementById('sncf_solution').innerHTML = "";
        document.getElementById('recos_sncf_desc').innerHTML = ""
        document.getElementById('sncf_solution_mock').hidden = true;
        
        var bodyHTML;
        var xhr = new XMLHttpRequest();
        xhr.withCredentials = true;
        xhr.addEventListener("readystatechange", function() {
          if(this.readyState === 4) {
            // document.getElementById('sncf_solution').innerHTML += recoSNCF;
          Swal.hideLoading();
          Swal.close();
          document.body.style.cursor = 'unset';
          console.log(JSON.parse(this.responseText))
          var recos = JSON.parse(this.responseText);
          var bodyHTML = "";
          for (var reco=0;reco<recos.length;reco++){  
                var description = recos[reco].description;
                var agent_type = recos[reco].agent_type;
                var title = recos[reco].title;
                var actions = recos[reco].actions;
                sessionStorage.setItem("actions"+"["+ reco + "]", JSON.stringify(actions[0]));
                bodyHTML += "<div><span class='rtePrd'><b onclick ='"+ 'showDescSNCF(' + reco + ')' + " '>" + title + "</b></span><br>" + '<button onclick="applyRecommandation(' +reco+ ')"' + 'class="rteBtn">Appliquer</button><hr>';
                bodyHTML += "<span id='descriptionSNCF" + reco + "' hidden>" + "<u>Description</u><br>" + description.replace("\n","<br>") + '</span>';

                document.getElementById('recos_sncf_desc').innerHTML = bodyHTML;
                document.getElementById('recos_sncf_desc').innerHTML += document.getElementById("sncf_button_grey").outerHTML.replace("hidden","");
             
           }
            // document.getElementById("sncf_button_grey").hidden = false;

           console.log("Ready - reco")
          }
        });
        xhr.open("POST", host +  "/cab_recommendation/api/v1/recommendation");
        xhr.setRequestHeader("Content-Type", "application/json");
        xhr.setRequestHeader("Authorization", "Bearer " + window.localStorage.token);
        var recommendationBody = 
          { context : contextSNCF,
            event : jsonEventObject
          }
        xhr.send(JSON.stringify(recommendationBody));
        }
    
    function getLastCard() {
        var xmlHttp = new XMLHttpRequest();
        xmlHttp.open("GET", host + "/cards/cards/"+ document.getElementsByClassName("card")[0].getAttribute("data-urlid"),false);
        xmlHttp.setRequestHeader("Authorization","Bearer "+ window.localStorage.token);
        xmlHttp.send(null);
        var response = JSON.parse(xmlHttp.responseText);
        var eventAttributes = response.card.data.metadata;
        console.log(eventAttributes);
        jsonEventObject = eventAttributes;
    };
    function traceInHistory(traceType,useCase,data){
      var data = JSON.stringify({
        "data": data,
        "date": new Date(),
        "step": traceType,
        "use_case": useCase
      });

      var xhr = new XMLHttpRequest();
      xhr.withCredentials = true;

      xhr.addEventListener("readystatechange", function() {
        if(this.readyState === 4) {
          console.info("TRACE",this.responseText);
        }
      });

      xhr.open("POST", traceHost + "/api/v1/traces");
      xhr.setRequestHeader("Content-Type", "application/json");
      xhr.send(data);
      console.log(data)
    }

    function askCab(){
      swal.showLoading();
      traceInHistory("ASKFORHELP",authorizedUseCase,{});

      switch(authorizedUseCase){
        case "SNCF":
          document.getElementById("sncf_assist_nominal").hidden = true;
          document.getElementById("sncf_assist_full").hidden = false;
          document.getElementById("recos_sncf_desc").hidden = false;
          getLastCard();
          console.log("ask cab get reco")
          // getRecommandationSNCF();
          getCardProcessSNCF();

        break;
        case "RTE":
        document.getElementById("rte_assist_nominal").hidden = true;
        document.getElementById("rte_assist").innerHTML = "";
        getCardProcess();
        break;
        case "DA":
        // console.log(this)
        //todo intégration service reco
        break;
      }
      }
    function applyRecommandation(reco){
      switch(authorizedUseCase){
        case "SNCF":
          document.getElementById("sncf_assist_nominal").hidden = true;
          document.getElementById("sncf_assist_full").hidden = false;
          document.getElementById("recos_sncf_desc").hidden = false;
          confirmAction(reco)
        break;
        case "RTE":
          confirmAction(reco)
        break;
      }
      }

      function applyRecommandationFinal(reco){
        document.getElementById("rte_assist_nominal").hidden = true;
          let action = sessionStorage.getItem("actions[" + reco +  "]");
          var data = action;
          var xhr = new XMLHttpRequest();
          xhr.withCredentials = true;
          document.body.style.cursor = 'wait';
          xhr.addEventListener("readystatechange", function() {
            if(this.readyState === 4 && this.status == 200) {
              console.log(this.responseText);
              document.body.style.cursor = 'unset';
              swalRecoSuccess();
            }else if (this.readyState === 4 && this.status != 200){
              swalRecoError(this.status);
              document.body.style.cursor = 'unset';
            }
          });
          if (selectedUseCase =="SNCF"){
            xhr.open("POST", "http://192.168.209.166:5000/transport_plan");
          }
          else{
            xhr.open("POST", "http://192.168.209.166:5100/api/v1/recommendations");
          }
          xhr.setRequestHeader("Content-Type", "application/json");
          xhr.send(data);
      }

      
  </script>


  <link rel="manifest" href="manifest.webmanifest">
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.3/dist/leaflet.css"
    integrity="sha256-kLaT2GOSpHechhsozzB+flnD+zUyjE2LlfWPgU04xyI=" crossorigin="" />
    <link rel="stylesheet" href=".\shared\css\timelineNG.css"> 
  <meta name="theme-color" content="#1976d2">
</head>

<body class="opfab-colors" id="bodyopfab" style="height:auto">

  <script src="https://unpkg.com/leaflet@1.9.3/dist/leaflet.js"
    integrity="sha256-WBkoXOwTeyKclOHuWtc+i2uENFpDZ9YPdf5Hf+D7ewM=" crossorigin=""></script>
  <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
  <script src=".\shared\js\timelineNG.js"></script>
  <script>

    function getCoordinates(){
      var request = new XMLHttpRequest();
      request.onreadystatechange= function () {
          if (request.readyState==4) {
            try {
            response = JSON.parse(request.responseText)
            //temporary fix for coordinates
              latitude = response[0].data.Latitude;
              longitude = response[0].data.Longitude;
              altitude = response[0].data.Altitude;
            } catch (error) {
              latitude = 47.9948;
              longitude = -4.09245;
            }
          
            console.log(response)
          }
      }
      request.open("GET", host + "/cabcontext/api/v1/contexts", true);
      request.setRequestHeader("Accept","application/json");
      request.setRequestHeader("Authorization","Bearer "+token);
      request.send();
    }

    function mapSNCF(){
      mapZoom = 6;
          initialLayer = "http://{s}.tile.osm.org/{z}/{x}/{y}.png";
          railwayLayer = "https://{s}.tiles.openrailwaymap.org/standard/{z}/{x}/{y}.png";
          defaultLatitude = 44.837789;
          defaultLongitude = -0.57918;
          map = L.map('map', {
            center: [defaultLatitude, defaultLongitude],
            zoom: mapZoom
          });
          var baseLayer = L.tileLayer(initialLayer).addTo(map);
          var topLayer = L.tileLayer(railwayLayer).addTo(map);

    }
    function mapDA(){
      mapZoom = 8;
          mapLayer = "https://{s}.tile.opentopomap.org/{z}/{x}/{y}.png";
          if(latitude === undefined || longitude === undefined){
              latitude = 47.9948;
              longitude = -4.09245;
          }
          map = L.map('map', {
            center: [latitude,longitude],
            zoom: mapZoom
          });
          L.tileLayer(mapLayer).addTo(map);
    }
    function setAndUpdateSNCFMarkersOnMap(data) {
      data.forEach(function (train) {
        if (!markers.hasOwnProperty(train.id_train)) {
          if(train.failure){
        iconUrl = "/assets/images/icons/train_ko.png"
        }else{
          iconUrl = "/assets/images/icons/train_ok.png"
        }
        let trainIconSrc = {iconUrl,iconSize: [20, 20]}
          let trainIcon = L.icon(trainIconSrc);
          let iconOptions = {title: train.id_train,draggable: false,icon: trainIcon}
          markers[train.id_train] = new L.Marker([train.latitude, train.longitude],iconOptions).addTo(map).on('click', markerOnClick);
          markers[train.id_train].attributes = train;
          markers[train.id_train].previousLatLngs = [];
        } else {
            if(train.latitude == null && train.longitude == null){
              lastLat = markers[train.id_train].previousLatLngs[markers[train.id_train].previousLatLngs.length-1].lat
              lastLong = markers[train.id_train].previousLatLngs[markers[train.id_train].previousLatLngs.length-1].lng
              markers[train.id_train].setLatLng([lastLat, lastLong]);
            }
            else {
              markers[train.id_train].previousLatLngs.push(markers[train.id_train].getLatLng());
              markers[train.id_train].setLatLng([train.latitude, train.longitude]);
            }
          }
      });
}
    function setAndUpdateDAMarkersOnMap(data) {
      planeMarker.setLatLng([data.Latitude, data.Longitude]);
    }

    function markerOnClick(e){
      markerOptions = e.sourceTarget.options;
      markerTitle = markerOptions.title;
      nb_passengers_connection = markers[markerTitle].attributes.nb_passengers_connection;
      nb_passengers_onboard = markers[markerTitle].attributes.nb_passengers_onboard;
      speed = markers[markerTitle].attributes.speed;
      map.setView([e.sourceTarget._latlng.lat,e.sourceTarget._latlng.lng],13)
      document.getElementById("sncf_ctx").innerHTML = 
      
      "<div id='data_train'>"
        +'<div id="train_infos">' + "TGV n° : " + markerTitle +"<br>"
        + "Vitesse : " + speed + "km/h" +"<br>"
        + "Direction : N/A" + "<br>"
        + "Voyageurs à bord  " + nb_passengers_onboard +"<br>"
        + "Voyageurs voiture  <br>"
        + "Température int. <br> "
      + "</div>"
      + '<div id="sncf_indice">'
      +'<img id="img_indice" src="assets\/images\/rame_indice.png">'
      +'</div></div>'
      + "<span style='margin-top:5px'><b>Communication avec la rame </b></span>"
      + '<div id="train_welcome"><img src="assets\/images\/train_passengers.png"><span id="txt_passengers" style="margin-left:5px;border: 1px solid">' + 
        'Chers clients  du train '+ markerTitle + msgs_train[Math.floor(Math.random() * (1 - 0 + 1) + 0)] + '</span></div>';
        
      document.getElementById("sncf_ctx_materiel").innerHTML =
      '<b>Etat de la râme </b><br> '+
      '<div id="train_infos">'
      // + "TGV n° : " + markerTitle +"<br>"
      + "Point kilométrique : " + 'N/A' +"<br>"
      + "Vitesse : " + speed + "km/h" +"<br>"
      + "Prochain arrêt : N/A" + "<br>"
      + "Destination : N/A" + "<br>"
      + "Voyageurs à bord : " + nb_passengers_onboard
      + "</div>";
      document.getElementById("materiel").classList.add("toBlink");
      document.getElementById("voyageurs").classList.add("toBlink");
      markers[markerTitle].bindPopup(markerOptions.title + "<br> Vitesse: " + speed + " km/h" );
      
    }

    function initMap(usecase) {

      switch (usecase) {
        case 'Dassault':
          mapZoom = 8;
          mapLayer = "https://{s}.tile.opentopomap.org/{z}/{x}/{y}.png";
          // valers par défaut si pas de contexte
          if(latitude === undefined || longitude === undefined){
              latitude = 47.9948;
              longitude = -4.09245;
          }
          var map = L.map('map', {
            center: [latitude,longitude],
            zoom: mapZoom
          });
          L.tileLayer(mapLayer, {
          }).addTo(map);
          let planeIcon = {
            iconUrl: "assets/images/plane_40x40.png",
            iconSize: [40, 40]
          }
          let myIcon3 = L.icon(planeIcon);
          let iconOptions3 = {
            draggable: false,
            icon: myIcon3
          }

          planeMarker = new L.Marker([latitude, longitude], iconOptions3);
          planeMarker.addTo(map).bindPopup(iconOptions3.title)
          break;
      }
      console.log("map init OK")
    }

  </script>
  <div id="usecase_hidden" hidden></div>
  <button id="updateSeverity" onclick="setCardsSeverity()" hidden></button>
  <button id="updateTimeLine" onclick="fillTimeLine()" hidden></button>
  
  <div id="assistOpTitle" style="font-size: 18px; color: var(--opfab-text-color);position: absolute;top: 90px;" hidden>
  <!-- <div id="assistOpTitle" style="font-size: 18px; color: grey;position: absolute;left: 1178px;top: 90px;" hidden> -->
    <b id="assist" hidden style="margin-left:3px;color:var(--opfab-text-color)">Assistance à l'opérateur</b>
    <b id="correlation" hidden>Corrélations</b>
    <b id="dassault_title" hidden>Assistance</b>
    <div id="sncf_assist" hidden>
      <div id ="sncf_assist_nominal" hidden> Comment puis-je vous aider? <br>
        <button class="sncf_button" onclick="askCab()"><b>Solliciter CAB</b></button>
      </div>
      <div id="sncf_assist_full" hidden>Recommandations de solutions
        <div id="sncf_actions">
          <button class="sncf_button_assist"><b>Nb. Clients</b></button>
          <button class="sncf_button_assist"><b>Retard</b></button>
          <button class="sncf_button_assist"><b>Coût</b></button>
        </div>
        <br>
        <div>
          <div id="recos_sncf_desc" hidden>
          </div>
          <div style="margin-left: 130px;margin-bottom: 5px;">
            <!-- <button class="sncf_button"><b>Choisir</b></button> -->
          </div>
        </div>
        <button id="sncf_button_grey" hidden class="sncf_button_grey" style="float:right" onclick="getRecommandations()" >Ajouter une solution</button>
      </div>
      <div id="sncf_solution" hidden style="margin-top: 50px"></div>
      <div id="sncf_solution_mock" hidden style="margin-top: 50px">
        <input type="checkbox" id="sol1" value="sol1">
        <label for="sol1">Retenue TGV 7652 à Angoulême</label>
        <hr>
        <input type="checkbox" id="sol2" value="sol2">
        <label for="sol2">Retenue TGV 5440 à Angoulême</label>
        <hr>
      </div>
    </div>
    <div id="nominal_assist" hidden>
      <img src="assets/images/cab_frame.png"><br>
      <b>Bonjour ! </b>
      <br>Je suis votre assistant bidirectionnel.
      <div id="nominal_assist_chat">
        <div id="userInput">Comment puis-je vous aider ? <img src="assets/images/mic.svg"> </div>
        <div>
          <img style="margin-left:10px;width:100%" src="assets/images/Icon CAB.svg">
        </div>
      </div>
    </div>
    <div id="nominal_assist_en" hidden>
      <img src="assets/images/cab_frame.png"><br>
      <b>Hello ! </b>
      <br>I am CAB, your bidirectional assistant.
      <div id="nominal_assist_chat">
        <div id="userInput">How can I help you? <img src="assets/images/mic.svg"> </div>
        <div>
          <img style="margin-left:10px;width:100%" src="assets/images/Icon CAB.svg">
        </div>
      </div>
    </div>
    <div id="orange_assist" hidden>
      <div id="orange_headers" style="display:flex">
        <div><button id="canari" class="orange_button_theme histo_tab canari" onclick='document.getElementById("stats_temps").hidden=true;document.getElementById("correlation_app_y").hidden=false'>Historique CANARI</button></div>
        <div><button class="orange_button_theme stats_tab stats" onclick='document.getElementById("stats_temps").hidden=false;document.getElementById("correlation_app_y").hidden=true;displaySwal()'>Statistiques</button></div>
      </div>
      <div id="stats_temps" hidden>
        <div id="orangeTimeSelector">
          <b>Fenêtre de temps</b>
          <br>
          <input type="range" id="slider" name="temp" list="values" />
          <datalist id="values">
            <option value="15" label="15mn"></option>
            <option value="60" label="1h"></option>
            <option value="120" label="2h"></option>
            <option value="180" label="3h"></option>
            <option value="240" label="4h"></option>
            <option value="300" label="5h"></option>
          </datalist>
        </div>
        <button id="display_result" onclick="">Afficher le résultat</button>
      </div>
      <div id="correlation_app_y" hidden>
        <div id="orange_correlation_notif">Correlation avec <button 
          class="orange_button orange_button_purple" 
          onclick="document.getElementById('orange_correlation_desc').hidden=false">App Y</button></div>
        <div id="orange_correlation_desc">
          <b>Incidents passés sur l'App X en corrélation avec l'App Y</b><br>
          Fiche CANARI APPX & Y <br>
          28/12/2023<br>
          <hr>
          Fiche CANARI APPX & Y<br>
          14/11/2023<br>
          <hr>
          <b>Action de rétalissement passées sur l'App X</b><br>
          Description de l'action de rétablissement<br>
          28/12/2023 
          <hr>
        </div>
      </div>
    </div>
    <div id="dassault_assist" hidden>
      <div id="da_bloc_content">
          <div class = "da_assist" id="high_procedure" hidden>
            <img src="assets\images\endofprocedure_da.png">
          </div>
          <div class = "da_assist" id="pdv_da" hidden>
            <img src="assets\images\pdv_da.png">
          </div>
      </div>
      <div id="da_block_request" hidden></div>
    </div>
    <div id ="rte_assist_nominal"  assistNeverTriggered="true" hidden><img style="width:100%" src="assets/images/assistop_colored.png"><br>
      <button class="sncf_button" style="margin-left: 100px" id="askCabButton" onclick="askCab()"><b>Solliciter CAB</b></button>
    </div>
    <div id = "rte_assist" class="opfab-card-template-rendering" style="display:none;font-size: 13px;width: 520px;">
    </div>
    <div id="opfab-div-card-template-alarm" class="opfab-card-template-rendering" style="display:none;font-size: 13px;width: 520px;">
      <b style="color:black">Parades</b><br><div><span class="rtePrd">Parade topologique: prise de schéma au poste 26 </span><button onclick="applyRecommandation()" class="rteBtn">Appliquer Parade</button><br>
      <span> LTTD: 5min</span>
</div>
      <!-- <span style="border-left:2px solid lightgrey"></span> -->
      <hr>
      <div><span class="rtePrd">Parade topologique : Prise de schéma au poste 16 </span><button onclick="applyRecommandation()" class="rteBtn">Appliquer Parade</button><br>
        <span> LTTD: 5min</span>
       </div>
      <hr>
      <div><span class="rtePrd">Parade topologique: prise de schéma au poste 28</span><button onclick="applyRecommandation()" class="rteBtn">Appliquer Parade</button><br>
      <span>LTTD: 5min</span></div>
      <hr>

      <div><span class="rtePrd">Changer de bus</span><button onclick="applyRecommandation()" class="rteBtn">Appliquer Parade</button><br>
      </div>
    </div>
    <div id="opfab-div-card-template-alarm-second" class="opfab-card-template-rendering" style="display:none;font-size: 13px;width: 520px;">
      <b style="color:black">Parades</b><br><div><span class="rtePrd">Parade topologique: prise de schéma au poste 16 </span><button onclick="applyRecommandation()" class="rteBtn">Appliquer Parade</button><br>
      <span> LTTD: 5min</span>
</div>
      <!-- <span style="border-left:2px solid lightgrey"></span> -->
      <hr>
      <div><span class="rtePrd">Parade topologique : Prise de schéma au poste 26 </span><button onclick="applyRecommandation()" class="rteBtn">Appliquer Parade</button><br>
        <span> LTTD: 5min</span>
       </div>
      <hr>
      <div><span class="rtePrd">Parade injection: redispatch de source de production</span><button onclick="applyRecommandation()" class="rteBtn">Appliquer Parade</button><br>
      <span>LTTD: 5min</span></div>
      <hr>

      <div><span class="rtePrd">Changer de bus</span><button onclick="applyRecommandation()" class="rteBtn">Appliquer Parade</button><br>
      </div>
    </div>
    <div id="opfab-div-card-template-security" class="opfab-card-template-rendering" style="display:none">
    <b style="color:black">Parades</b><br>
    <span>Aucune parade trouvée pour cet évènement</span>
    <hr>
    <div>
      Action suggérée - réaliser une étude complémentaire
      <button onclick="applyRecommandation()" class="rteBtn">Utiliser l'outil d'étude</button>
    </div>
    </div>
    <div id="opfab-div-card-template-noparades" class="opfab-card-template-rendering" style="display:none">
      <b style="color:black">Parades</b><br>
      <span>Aucune parade trouvée pour cet évènement</span>
    </div>
    <div id="opfab-div-card-template-agent" class="opfab-card-template-rendering" style="display:none">
      <b style="color:black">Parades</b><br>
      <b style="font-size: 15px">Je ne suis pas en mesure de vous fournir une assistance pour cet évènement </b>
    </div>

  </div>
  <of-root>  
  </of-root>
  <noscript>Please enable JavaScript to continue using this application.</noscript>
  <div id="tl-container-home" hidden>
    <div id ="tl-box" class="timeline-container timeline-border">
      <div style="font-size:18px;color:var(--opfab-text-color);margin-left:3px;overflow: hidden"><b>Timeline</b></div>
        <div class="timeline" id="timelineNG">
            <div class="global-current-time-cursor">
              <img style='width: 17px;
                    position: absolute;
                    left: -6px;
                    top: -5px;
                    color:rgb(114,114,114)'
              src='./assets/images/time_cursor.png'/>
                <div id="current-time"><b></div>
            </div> 
            <div id="timeline-line" class="timeline-line" style="
            border-top: solid;
            margin-top: 15px;
            padding: 2px;
"><div class="timeline-hour" style="left: 0;margin-top: -5px;"></div><div class="timeline-hour" style="left: 25%;margin-top: -5px;">06:00
</div><div class="timeline-hour" style="left: 50%;margin-top: -5px;"> 12:00</div><div class="timeline-hour" style="left: 75%;margin-top: -5px;">18:00</div><div class="timeline-hour" style="right: 0;"></div></div>
            <div id="eventsForTimeLine" hidden></div>
        </div>
    </div>
</body>

</html>